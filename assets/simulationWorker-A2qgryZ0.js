(function(){"use strict";self.addEventListener("message",w=>{if(!w)return;const g=w.data;let s=g.table.content,o=[],k=[],h=0;const I=e=>e%11,m=e=>{var t=0;if(e.length===0)return t;for(var l=0;l<e.length;l++){var v=e.charCodeAt(l);t=(t<<5)-t+v,t=t&t}return Math.abs(t)};for(let e=0;e<s.length;e++){let t=s[e].word,l=m(t);l=I(l),o.push(l),k[l]={hashTable:[],overflowBuckets:[]}}o=[...new Set(o)],o.sort(),h=Math.ceil(s.length/o.length);const M=o.length;let c=0,i=0;const{pageAmount:p,pageSize:b}=g.meta;let a=[];p>0?(c=Math.ceil(s.length/p),i=p):b>0&&(i=Math.ceil(s.length/b),c=b);const n=s.slice();for(let e=n.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[n[e],n[t]]=[n[t],n[e]]}for(let e=0;e<i;e++){const t=e*c;if(t>=n.length)break;const l=Math.min(t+c,n.length);a[e]=n.slice(t,l)}let f=0;for(let e=0;e<a.length;e++)for(let t=0;t<a[e].length;t++){let l=e,v=a[e][t].word,d=a[e][t].id,S=m(v),u=I(S);u=u===-0?0:u;let r=k[u];if(r)if(r.hashTable.length<h)r.hashTable.push({pageId:l,tupleId:d});else if(r.overflowBuckets.length>0){let T=r.overflowBuckets.find(z=>z.hashTable.length<h);T?T.hashTable.push({pageId:l,tupleId:d}):(r.overflowBuckets.push({id:u,hashTable:[{pageId:l,tupleId:d}],isOverflowBucket:!0}),f+=1)}else r.overflowBuckets=[],r.overflowBuckets.push({id:u,hashTable:[{pageId:l,tupleId:d}],isOverflowBucket:!0}),f+=1}const A=(f/M).toFixed(2)*100,B={};k.forEach((e,t)=>{e!==void 0&&(B[t]=e)});const L={rows:s,pageList:a,bucketList:B,pageAmount:i,pageSize:c,meta:{...g.meta,bucketAmount:o.length,bucketSize:h,bucketIds:o,totalOverflowAmount:f,overflowRate:A}};postMessage(L)})})();
